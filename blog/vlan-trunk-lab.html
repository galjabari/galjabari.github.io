<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Learn how to configure VLAN trunking on Arista cEOS switches using Containerlab.">
    <title>Ghannam Aljabari</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Blog</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <h5>Configure VLAN Trunking on Arista cEOS</h5>
        <p>This guide demonstrates how to configure VLANs and VLAN trunking on Arista cEOS switches using Containerlab. The lab includes a Layer 3 switch providing routing and DHCP services, along with two Layer 2 switches that extend VLANs to connected client devices.</p>
        <h6>1. Create a network topology</h6>
        <p>To create a network topology, use the following Containerlab configuration file named <code>trunk.clab.yml</code>:</p>
        <pre>
name: layer3

topology:
  nodes:
    # Layer 3 switch (Arista cEOS)
    spine:
      kind: arista_ceos
      image: takfa19/ceos:4.32.2F
      startup-config: spine.cfg 
    
    # Layer 2 switch (Arista cEOS)
    leaf1:
      kind: arista_ceos
      image: takfa19/ceos:4.32.2F
      startup-config: leaf.cfg 

    # Layer 2 switch (Arista cEOS)
    leaf2:
      kind: arista_ceos
      image: takfa19/ceos:4.32.2F
      startup-config: leaf.cfg 

    # Client 1 (Linux container)
    client1:
      kind: linux
      image: alpine:latest
      # Use udhcpc for DHCP client functionality
      exec:
        - ip route del default
        - udhcpc -i eth1

    # Client 2 (Linux container)
    client2:
      kind: linux
      image: alpine:latest
      # Use udhcpc for DHCP client functionality
      exec:
        - ip route del default
        - udhcpc -i eth1

    # Client 3 (Linux container)
    client3:
      kind: linux
      image: alpine:latest 
      # Use udhcpc for DHCP client functionality
      exec:
        - ip route del default
        - udhcpc -i eth1

    # Client 4 (Linux container)
    client4:
      kind: linux
      image: alpine:latest
      # Use udhcpc for DHCP client functionality
      exec:
        - ip route del default
        - udhcpc -i eth1

  links:
    - endpoints: ["spine:eth1", "leaf1:eth3"]
    - endpoints: ["spine:eth2", "leaf2:eth3"]
    - endpoints: ["leaf1:eth1", "client1:eth1"]
    - endpoints: ["leaf1:eth2", "client2:eth1"]
    - endpoints: ["leaf2:eth1", "client3:eth1"]
    - endpoints: ["leaf2:eth2", "client4:eth1"]
</pre>
        <p>This configuration defines the spine switch, two leaf switches, and four clients. Each client is set up to automatically obtain an IP address from the DHCP server running on the spine switch.</p>
        <p>Next, create the startup configuration files for the switches.</p>
        <p>In the same directory as your YAML file, create a file named <code>spine.cfg</code> with the following content:</p>
        <pre>
!
enable
configure terminal
!
username admin privilege 15 secret admin
!
ip routing
!
vlan 10
   name VLAN10
vlan 20
   name VLAN20
!
interface Vlan10
   ip address 192.168.10.1/24
   dhcp server ipv4
   no shutdown
!
interface Vlan20
   ip address 192.168.20.1/24
   dhcp server ipv4
   no shutdown
!
interface Ethernet1
   switchport mode trunk
   switchport trunk allowed vlan 10,20
!
interface Ethernet2
   switchport mode trunk
   switchport trunk allowed vlan 10,20
!
dhcp server
   subnet 192.168.10.0/24
      range 192.168.10.20 192.168.10.100
      default-gateway 192.168.10.1
   !
   subnet 192.168.20.0/24
      range 192.168.20.20 192.168.20.100
      default-gateway 192.168.20.1
   !
!
end
</pre>
        <p>Create a file named <code>leaf.cfg</code>, which will be used for both leaf switches:</p>
        <pre>
!
enable
configure terminal
!
username admin privilege 15 secret admin
!
vlan 10
   name VLAN10
vlan 20
   name VLAN20
!
interface Ethernet1
   switchport mode access
   switchport access vlan 10
!
interface Ethernet2
   switchport mode access
   switchport access vlan 20
!
interface Ethernet3
   switchport mode trunk
   switchport trunk allowed vlan 10,20
!
end
</pre>
        <h6>2. Deploy and verify the lab</h6>
        <p>Deploy the topology with the following command:</p>
        <pre>clab deploy -t trunk.clab.yml</pre>
        <p>After the lab is deployed, you can test connectivity between clients. For example, to test communication between clients in the same VLAN but on different switches, access <code>client1</code> and ping <code>client3</code>. You can access the client with the following command:</p>
         <pre>docker exec -it clab-trunk-client1 sh</pre>
        <p>To access the CLI for each switch, use the following commands:</p>
        <pre>docker exec -it clab-trunk-spine Cli</pre>
        <pre>docker exec -it clab-trunk-leaf1 Cli</pre>
        <pre>docker exec -it clab-trunk-leaf2 Cli</pre>
        <p>On the spine, verify the IP routing table and DHCP leases:</p>
        <pre>show ip route</pre>
        <pre>show dhcp server leases</pre>
        <p>On the leaf switches, verify the VLAN and trunk interface configurations:</p>
        <pre>show vlan</pre>
        <pre>show interfaces trunk</pre>
        <h6>3. Clean up the lab</h6>
        <p>When you are finished, you can destroy the lab environment and remove all related files with the following command:</p>
        <pre>clab destroy -t trunk.clab.yml --cleanup</pre>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
