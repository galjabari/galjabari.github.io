<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Learn how to configure Per-VLAN Spanning Tree (PVST) on Arista cEOS switches using Containerlab to load balance traffic across redundant links.">
    <title>Ghannam Aljabari</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Blog</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <h5>Configure Per-VLAN Spanning Tree on Arista cEOS</h5>
        <p>Per-VLAN Spanning Tree (PVST) is a Cisco proprietary protocol that runs a separate instance of the STP for each VLAN. This allows for load balancing of traffic for different VLANs on the same set of links. This guide demonstrates how to configure PVST on Arista cEOS switches using Containerlab.</p>
        <h6>1. Create a network topology</h6>
        <p>To create a network topology, use the following Containerlab configuration file named <code>pvst.clab.yml</code>:</p>
        <pre>
name: pvst
topology:
  nodes:
    switch1:
      kind: arista_ceos
      image: takfa19/ceos:4.32.2F
      startup-config: switch.cfg
    switch2:
      kind: arista_ceos
      image: takfa19/ceos:4.32.2F
      startup-config: switch.cfg

  links:
    - endpoints: ["switch1:eth1", "switch2:eth1"]
    - endpoints: ["switch1:eth2", "switch2:eth2"]
</pre>
        <p>This topology defines two switches with two redundant links.</p>
        <p>Next, create the startup configuration files for the switches.</p>
        <p>In the same directory as your YAML file, create a file named <code>switch.cfg</code>, which will be used for both switches:</p>
        <pre>
!
enable
configure terminal
!
username admin privilege 15 secret admin
!
spanning-tree mode rapid-pvst
!
vlan 10
   name VLAN10
vlan 20
   name VLAN20
!
interface Ethernet1
   switchport mode trunk
   switchport trunk allowed vlan 10,20
   spanning-tree vlan 10 port-priority 64
!
interface Ethernet2
   switchport mode trunk
   switchport trunk allowed vlan 10,20
   spanning-tree vlan 20 port-priority 64
!
end
</pre>
<p>This configuration sets up two VLANs (10 and 20) and enables Rapid PVST. The port priorities are adjusted to 64 so that, for VLAN 10, one link is forwarding while the other is blocking; for VLAN 20, the roles are reversed. The default port priority for PVST is 128, and the lower the number, the higher the priority.</p>
        <h6>2. Deploy and verify the lab</h6>
        <p>Deploy the topology with the following command:</p>
        <pre>clab deploy -t pvst.clab.yml</pre>
        <p>After the lab is deployed, you can verify the PVST configuration. Access <code>switch1</code> and check the spanning tree status for VLAN 10 and VLAN 20.</p>
        <p>To access <code>switch1</code>, use the following command:</p>
        <pre>docker exec -it clab-pvst-switch1 Cli</pre>
        <p>On <code>switch1</code>, you can check the spanning tree status for VLAN 10:</p>
        <pre>show spanning-tree vlan 10</pre>
        <p>And for VLAN 20:</p>
        <pre>show spanning-tree vlan 20</pre>
        <h6>3. Clean up the lab</h6>
        <p>When you are finished, you can destroy the lab environment and remove all related files with the following command:</p>
        <pre>clab destroy -t pvst.clab.yml --cleanup</pre>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
